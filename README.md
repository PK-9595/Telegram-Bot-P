# Telegram-Based Outdoor Adventure Puzzle Game

This project aims to create an interactive Telegram-based outdoor adventure game where players are guided through local attractions, solving puzzles to reach the next location while learning about local history and lore. 
- The game can be played individually or in cooperatively in groups but requires a server for running a script used to control the telegram bot.
- Multiple game sessions can go on simultaneously on a single server.
- Game stages and puzzles are accurate/relevant as of 2024, changes to the local scene could affect playability of the game.

---

## Steps to Set Up the Project

### 1. Clone the Repository
Download or clone this repository onto the server used to host the game / run the script by running:

```bash
git clone git@github.com:PK-9595/Telegram-Bot-P.git
```

### 2. Install Dependencies
Navigate to the project directory and install/update the required dependencies:
```bash
npm install
```

### 3. Install MySQL
Install MySQL on your system:
- Linux (Ubuntu/Debian):
  ```bash
  sudo apt install mysql-server
  ```
- Windows (Chocolatey):
  ```bash
  choco install mysql
  ```

### 4. Create a MySQL Root Account
Set up your MySQL root account by following MySQL's secure installation prompts or manual user creation.
- Windows: Start the MySQL Workbench application to create a root account.
*Please remember the MySQL root account password as it will be required later*

### 5. Start MySQL Service
Ensure MySQL is running by executing:
- Linux
  ```bash
  sudo systemctl start mysql
  ```
- Windows:
  Go to the Task Manager > `Services` > `MySQL80` > Right Click and select `Start`

### 6. Create a Telegram Bot
Through the telegram interface, create a bot:
1. Open Telegram (either the mobile app or desktop version)
2. Search for `BotFather` in the search bar and select the verified `BotFather` account (with a blue checkmark).
3. In a chat with `BotFather`, enter `/newbot` to create a new bot.
4. Follow the prompts to set the bot name and a unique bot username.
5. Obtain the token generated by `BotFather`, which looks like `123456789:ABCdefGhIJKlmNOPqrStUvWxyZ
`. *This token is important, save it securely, as it will be required to authenticate your bot and interact with Telegram's API*
6. You may begin chatting with your bot by searching for it using its username that was set earlier. However, at this point the bot will remain unresponsive.

### 7. Edit & Rename `.env.example` File
Update the value for `TELEGRAM_BOT_TOKEN` and the `MYSQL_PASSWORD` in the `.env.example` file accordingly, then rename the file to `.env`

### 8. Configure Game (OPTIONAL)
Certain fields in the `userInput.js` file can be updated:
- `startPhrase` contains the phrase to enter to start the game. When this phrase is sent to the bot in a message, the bot will proceed with setting up the game.
- `validGameCodes` contains one or more game codes. Provide any of these codes to the bot to create a game when prompted. Using a game code to create a game will remove it from the pool; each game code can only be used to create 1 game.

### 9. Start Operating the Bot
Start the bot by running the following command in the terminal from the project directory:
```bash
node telegram-bot.js
```
*The machine you run this command on needs to stay powered on and connected to the internet throughout the game, as it is used to operate the Telegram Bot.*

### 10. Begin the game!
You may now begin chatting with your telegram bot, use the `startPhrase` in the `userInput.js` file to start setting up a game session.

<br>

---

<br>

## TROUBLESHOOTING:
- In the event of connectivity issues, ensuring that your machine is using IPv4 for the connection instead of IPv6 could help to solve it.
- If there is an issue accessing the mysql server from the client, using the follow SQL command might help:
  ```sql
  ALTER USER 'yourUsername'@'localhost' IDENTIFIED WITH mysql_native_password BY 'yourPassword'; FLUSH PRIVILEGES;
    ```

<br>

---

<br>

## ADDITIONAL EXPLANATION ABOUT THE PROJECT
- This project uses a javascript script to control the telegram bot through the telegram API.
- No port forwarding has to be done since the telegram bot uses polling - users send messages to the telegram server, and the telegram bot running on the local machine regularly asks the telegram server if it has any messages for it.
- The javascript script contains an event listener that listens for messages and responds according to the message received as well as the details of the sender, stored and retrieved using MySQL.
- The javascript script communicates with the MySQL database to store/retrieve information such as the details about each player, what stages they are in or what game session they are in, the existing game sessions, as well as remaining codes/tokens that can be used to start the game. Refer to the `mysql.js` file for more details.
- Each time the `telegram-bot.js` script is run, the MySQL database is reset, and codes/tokens that can be used to start the game specified in the `userInput.js` file are re-inserted into the game.
- Within each game session regardless of single-player or multi-player, the telegram bot behaves synchronously, responding to messages in order, as there is a message queue for each session.
- When multiple game sessions are going on at the same time, the telegram bot behaves asynchronously - it handles each session independently without blocking others, allowing concurrent gameplay across different users despite being single-threaded.
